**Table of Contents**

[TOC]

## Overview

The Matlab Grader Test Generator can be packaged and run as an standalone app, however, it is more beneficial to open and run in conjunction with Matlab for development purposes. 

Steps to open application:

* Clone repository from GitHub
* Open Matlab (Confirmed  to be working with r2018a)
* Home → Open → navigate to ...src\TestGenApp and select GenGui_app
* A new window will open with the application

Update 4 September 2018: If you get an error "unable to open MATLAB Window application" when trying to open to app, you may follow the advice on this [link](https://www.mathworks.com/matlabcentral/answers/397138-why-do-i-get-a-matlabwindow-application-failed-to-launch-error-when-launching-live-editor-app-des).

To inspect/modify the source code of the application, right click the GenGui_app.mlapp file and click open.

A new window called app designer will open. To see the code for the application GUI there is a toggle switch in the upper right corner labeled "Design View / Code View".

## Functions
There are four separate function files bundled with the application.  They are contained within the sub-directory named "Functions". If you want to move them, there is a single line in the application code that must be changed to specify the relative path to the functions. 

### Import Variables
The function called "importVariables" imports variables from the workspace created by the learner and solution .mat files. 

It requires minimum two inputs, and accepts a maximum of three. 
The mandatory two being .m files containing solution template and learner template.
The optional on is an array cell containing variables to be excluded from testing
It runs the two scripts, importing workspace variables with the Matlab keyword "whos". All the variables that does not require testing, or are created by the function, are excluded with
an regular expression pattern. Finally it returns two structures containing the variable names and data from each .m file.

### Compare Structures
The function "compareStructures" takes two structures as input, compares them and returns a new structure containing all elements not found in both input structures, in other words those uncommon for both.

- Takes two separate structures as input

- The first structure gets compared against the second structure

- Iterates through every element 

- Places elements which are present in structure one and not in structure two, in a new structure

  

### Remove Uncommon
The function "removeUncommon" takes two separate structures as input, and returns a new structure.
The first structure being either the student template or the solution template
The second structure being corresponding unique structure found in the previous function ("compareStructures").

It then compares the two inputs and places every element not present in both structures in a new struct. The new structure is returned, which will be a sum of the first structure minus all elements not common in both. This will ultimately be the one with all the variables common in learner and solution template, and is then used for creating tests.

### Print Test
The function "printTest" takes six inputs, where the three first are mandatory and the three last are optional and only used if you enter a custom text in the test generator.

- The first is the filtered structure which only contains the variables common to the learner and reference solution.
- The second and third contains the path name and file name for output text file.
- The remaining three inputs are used to customize the test output text.

Based on path name and test name it creates a text file.  It will then iterates through the structure and prints a few line of code to the text file for each element.
Below is a sample test printed by the function.

 ```matlab
disp('Reference Solution: ')  
referenceVariables.numF1  
disp('Student Solution: ')  
numF1  
assessVariableEqual('numF1',referenceVariables.numF1)  
 ```

If any other format is required, the output can easily be altered in the body of the function or in the test generator GUI.

## GUI

![GUI.png](https://github.com/NTNU-IE-IIR/matlab-grader-test-generator/blob/master/matlab-grader-test-generator.wiki/app_gui.png)

Above is the graphical user interface of the test generator. 

The functions are described starting from top left:

* A file browser where the user is asked to select a Solution template. 
* A file browser where the user is asked to select a Learner template. 
* A file browser where the user is asked to select a Location to save the text file generated by the app.
  The text fields displays the path selected.

When you press the generate test button, the callback will run the functions previously listed.

It will most likely result in either of these cases/scenarios with corresponding output:

- **Case**: All files are selected and correct

  Return: Tests are successfully generated

- **Case**: One or more files are not selected

  Return: It will only display a message telling the user that not all files are selected

- **Case**: All files are selected but might not be correct
- Return: Errors will be caught and displayed in the output field.  This can be altered to display a simpler version of the error.


The large field with 3 tabs contains: 

* **Output**
  Prints error messages if they are caught by the try/catch statement
  Prints feedback if tests are successfully generated, and information about the path of the text file and which variables were excluded.


* **Exclude**
  An editable text field for manually excluding variables.
  Requires user to write down variable names in the following form: 
  Note: case sensitive and maximum one variable name per line:
  variableName1
  variableName2
  variableName3
  When all variables have been entered, the "submit" button must be pressed to pass the list on to the 
  importVariables function.

* **Custom Print**
  Allows the user to edit the output generated. Contains three text boxes where each box represents a line in the test output.

Above the "Generate Tests" button there is a small text field that gives short feedback based on user action.

If the user wish to start a new, a reset button located in the top left corner, which clears all values and returns the state to default.


Note that there are also a few places in the GUI code where there are included some commented code which either stores variables to Matlab workspace and/or outputs to the command window for debugging purposes.

## Example Use
In order to utilize this application you are required to have two .m files, where one contains the solution and the other one the learner template. Note that the variables must appear in the same order in both files.


Below are two sample scripts. 

The first one is the solution template which contains the correct answer.

```matlab
%% Solution Template
% Circle
r = 2; % Radius
areaCircle = pi*r^2;
circumferenceCircle = 2*pi*r;

% Right triangle 
a = 3; % Cathetus
b = 4; % Cathetus
c = 5; % Hypotenuse
areaTriangle = (1/2)*a*b;
circumferenceTriangle = a+b+c;

% Rectangle
x = 6; % Widht
y = 7; % Height
areaRectangle = x*y;
circumferenceRectangle = (2*x)+(2*y);

% Trapezoid
n = 4;  % Top
b = 10; % Bottom
m = 2;  % Height
areaTrapezoid = ((n+b)/2)*m;

%A kangaroo is capable of jumping to a height of 2.62 m. Determine the takeoff speed of the kangaroo.
ay = -9.8; % Gravity 
s = 2.62;  % Distance height
%vf = vi^2 + 2*a*s; 
% Note that vf = 0 
vi = sqrt(-(2*ay*s));
```
The second one is the learner template which the students will see, it is identical to the solution template except some of the variable declarations has been omitted.

```matlab
%% Learner template
% Circle
r = 2; % Radius
areaCircle = 'Fill in answer here';
circumferenceCircle = 'Fill in answer here';

% Right triangle 
a = 3; % Cathetus
b = 4; % Cathetus
c = 5; % Hypotenuse
areaTriangle = 'Fill in answer here';
circumferenceTriangle = 'Fill in answer here';

% Rectangle
x = 6; % Widht
y = 7; % Height
areaRectangle = 'Fill in answer here';
circumferenceRectangle = 'Fill in answer here';

% Trapezoid
n = 4;  % Top
b = 10; % Bottom
m = 2;  % Height
areaTrapezoid = 'Fill in answer here';

%A kangaroo is capable of jumping to a height of 2.62 m. Determine the takeoff speed of the kangaroo.
ay = -9.8; % Gravity 
s = 2.62;  % Distance height
%vf = vi^2 + 2*a*s; 
% Note that vf = 0 
vi = 'Fill in answer here';
```
Using the test generator with the two aforementioned scripts will produce the following output. 

```matlab
disp('Reference Solution: ')
referenceVariables.a
disp('Student Solution: ')
a
assessVariableEqual('a',referenceVariables.a)


disp('Reference Solution: ')
referenceVariables.areaCircle
disp('Student Solution: ')
areaCircle
assessVariableEqual('areaCircle',referenceVariables.areaCircle)


disp('Reference Solution: ')
referenceVariables.areaRectangle
disp('Student Solution: ')
areaRectangle
assessVariableEqual('areaRectangle',referenceVariables.areaRectangle)


disp('Reference Solution: ')
referenceVariables.areaTrapezoid
disp('Student Solution: ')
areaTrapezoid
assessVariableEqual('areaTrapezoid',referenceVariables.areaTrapezoid)


disp('Reference Solution: ')
referenceVariables.areaTriangle
disp('Student Solution: ')
areaTriangle
assessVariableEqual('areaTriangle',referenceVariables.areaTriangle)


disp('Reference Solution: ')
referenceVariables.ay
disp('Student Solution: ')
ay
assessVariableEqual('ay',referenceVariables.ay)


disp('Reference Solution: ')
referenceVariables.b
disp('Student Solution: ')
b
assessVariableEqual('b',referenceVariables.b)


disp('Reference Solution: ')
referenceVariables.c
disp('Student Solution: ')
c
assessVariableEqual('c',referenceVariables.c)


disp('Reference Solution: ')
referenceVariables.circumferenceCircle
disp('Student Solution: ')
circumferenceCircle
assessVariableEqual('circumferenceCircle',referenceVariables.circumferenceCircle)


disp('Reference Solution: ')
referenceVariables.circumferenceRectangle
disp('Student Solution: ')
circumferenceRectangle
assessVariableEqual('circumferenceRectangle',referenceVariables.circumferenceRectangle)


disp('Reference Solution: ')
referenceVariables.circumferenceTriangle
disp('Student Solution: ')
circumferenceTriangle
assessVariableEqual('circumferenceTriangle',referenceVariables.circumferenceTriangle)


disp('Reference Solution: ')
referenceVariables.m
disp('Student Solution: ')
m
assessVariableEqual('m',referenceVariables.m)


disp('Reference Solution: ')
referenceVariables.n
disp('Student Solution: ')
n
assessVariableEqual('n',referenceVariables.n)


disp('Reference Solution: ')
referenceVariables.r
disp('Student Solution: ')
r
assessVariableEqual('r',referenceVariables.r)


disp('Reference Solution: ')
referenceVariables.s
disp('Student Solution: ')
s
assessVariableEqual('s',referenceVariables.s)


disp('Reference Solution: ')
referenceVariables.vi
disp('Student Solution: ')
vi
assessVariableEqual('vi',referenceVariables.vi)


disp('Reference Solution: ')
referenceVariables.x
disp('Student Solution: ')
x
assessVariableEqual('x',referenceVariables.x)

disp('Reference Solution: ')
referenceVariables.y
disp('Student Solution: ')
y
assessVariableEqual('y',referenceVariables.y)
```
Note that the output can be adjusted to suit your needs.
Each of the tests can be pasted to Matlab Gader where it will perform a variable equals reference solution test.

### Customizing Print
You can customize the output by entering  the 'Custom Print' tab and entering desired output.

![GUI_CUSTOM.png](https://github.com/NTNU-IE-IIR/matlab-grader-test-generator/blob/master/matlab-grader-test-generator.wiki/app_custom_print.png)

Below is a sample of a customized print, where the '---------- CUSTOMIZE HERE ----------' is the section which will changed. Each of the three lines can be changed separately. The structure can only be changed in the source code of the function.


```matlab
---------- CUSTOMIZE HERE ----------
referenceVariables.areaCircle
---------- CUSTOMIZE HERE ----------
areaCircle
assessVariableEqual('areaCircle',referenceVariables.areaCircle)
---------- CUSTOMIZE HERE ----------
```

## Contributions and License

This application was developed by a student in the [Cyber-Physical Systems Laboratory](https://www.ntnu.no/blogger/cpslab/) at the [Norwegian University of Science and Technology](https://www.ntnu.no) in Ålesund, Norway, as part of an educational project funded by [Excited](https://www.ntnu.edu/excited), a Norwegian Centre for Excellent IT Education. Anyone is free to use this code as per the [MIT License](https://github.com/NTNU-IE-IIR/matlab-grader-test-generator/blob/master/LICENSE). 

